<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>DASHBOARD OVERVIEW PROFILLING UNIT ENTRY</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  </head>

  <body class="bg-gray-100 p-6">
    <h1 class="text-2xl font-bold mb-6">OVERVIEW PROFILLING UNIT ENTRY</h1>
    <div class="bg-white rounded shadow p-6 mb-6">
      <form id="filterForm" class="grid grid-cols-1 md:grid-cols-5 gap-4">
        <!-- Tahun -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">
            Tahun
          </label>
          <select
            id="filterYear"
            class="w-full border rounded px-3 py-2 text-sm"
          >
            <option value="">Semua Tahun</option>
            <option value="2023">2023</option>
            <option value="2024">2024</option>
            <option value="2025">2025</option>
          </select>
        </div>

        <!-- Bulan -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">
            Bulan
          </label>
          <select
            id="filterMonth"
            class="w-full border rounded px-3 py-2 text-sm"
          >
            <option value="">Semua Bulan</option>
            <option value="01">Januari</option>
            <option value="02">Februari</option>
            <option value="03">Maret</option>
            <option value="04">April</option>
            <option value="05">Mei</option>
            <option value="06">Juni</option>
            <option value="07">Juli</option>
            <option value="08">Agustus</option>
            <option value="09">September</option>
            <option value="10">Oktober</option>
            <option value="11">November</option>
            <option value="12">Desember</option>
          </select>
        </div>

        <!-- Kabupaten -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">
            Kabupaten
          </label>
          <select
            id="filterKabupaten"
            class="w-full border rounded px-3 py-2 text-sm"
          >
            <option value="">Semua Kabupaten</option>
            <option value="bandung">Bandung</option>
            <option value="bogor">Bogor</option>
            <option value="bekasi">Bekasi</option>
          </select>
        </div>

        <!-- Dealer -->
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">
            Dealer
          </label>
          <select
            id="filterDealer"
            class="w-full border rounded px-3 py-2 text-sm"
          >
            <option value="">Semua Dealer</option>
            <option value="dealer_a">Dealer A</option>
            <option value="dealer_b">Dealer B</option>
          </select>
        </div>

        <!-- Action -->
        <div class="flex items-end gap-2">
          <button
            type="submit"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm w-full"
          >
            Terapkan
          </button>
          <button
            type="button"
            id="resetFilter"
            class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded text-sm w-full"
          >
            Reset
          </button>
        </div>
      </form>
    </div>

    <!-- GRID -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- UNIT ENTRY -->
      <div class="bg-white rounded shadow p-6">
        <h2 class="font-semibold text-gray-600 mb-4">UNIT ENTRY</h2>
        <p id="unitEntryValue" class="text-3xl font-bold">-</p>
        <p class="text-sm text-gray-500 mt-2">Jumlah sebesar TOJ 1:1</p>
      </div>

      <!-- TOTAL AMOUNT -->
      <div class="bg-white rounded shadow p-6">
        <h2 class="font-semibold text-gray-600 mb-4">TOTAL AMOUNT</h2>
        <p id="totalAmountValue" class="text-3xl font-bold">-</p>
        <p class="text-sm text-gray-500 mt-2">Jumlah sebesar Total Amount</p>
      </div>

      <!-- TOJ BAR -->
      <div class="bg-white rounded shadow p-4">
        <h2 class="font-semibold text-gray-600 mb-2">TOJ 1:1</h2>
        <div id="tojBar"></div>
      </div>
    </div>

    <!-- ROW 2 -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
      <!-- PIE JENIS KELAMIN -->
      <div class="bg-white rounded shadow p-4">
        <h2 class="font-semibold text-gray-600 mb-2">Jenis Kelamin</h2>
        <div id="genderPie"></div>
      </div>

      <!-- TYPE MOTOR -->
      <div class="bg-white rounded shadow p-4">
        <h2 class="font-semibold text-gray-600 mb-2">Type Motor</h2>
        <div id="motorBar"></div>
      </div>

      <!-- PEKERJAAN -->
      <div class="bg-white rounded shadow p-4">
        <h2 class="font-semibold text-gray-600 mb-2">
          Jenis Pekerjaan Konsumen
        </h2>
        <div id="jobBar"></div>
      </div>
    </div>

    <script>
      async function loadUnitEntry() {
        try {
          const res = await fetch(
            "https://msk-dashboard-production.up.railway.app/api/total-entry"
          );
          const data = await res.json();

          const total = data.total_entry;
          let displayValue = "";

          if (total >= 1000) {
            // ribuan (Rb) dengan 1 desimal
            const ribuan = total / 1000;
            displayValue =
              ribuan.toLocaleString("id-ID", {
                minimumFractionDigits: 1,
                maximumFractionDigits: 1,
              }) + " Rb";
          } else {
            // ratusan / puluhan â†’ tampilkan langsung
            displayValue = total.toLocaleString("id-ID");
          }

          document.getElementById("unitEntryValue").innerText = displayValue;
        } catch (err) {
          console.error("Gagal load total entry:", err);
          document.getElementById("unitEntryValue").innerText = "-";
        }
      }

      loadUnitEntry();
    </script>

    <script>
      function formatSmartNumber(value) {
        const abs = Math.abs(value);

        if (abs >= 1_000_000_000_000) {
          return (
            (value / 1_000_000_000_000).toLocaleString("id-ID", {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            }) + " T"
          );
        }

        if (abs >= 1_000_000_000) {
          return (
            (value / 1_000_000_000).toLocaleString("id-ID", {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            }) + " M"
          );
        }

        if (abs >= 1_000_000) {
          return (
            (value / 1_000_000).toLocaleString("id-ID", {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            }) + " Jt"
          );
        }

        if (abs >= 1_000) {
          return (
            (value / 1_000).toLocaleString("id-ID", {
              minimumFractionDigits: 1,
              maximumFractionDigits: 1,
            }) + " Rb"
          );
        }

        return value.toLocaleString("id-ID");
      }

      async function loadTotalAmount() {
        try {
          const res = await fetch(
            "https://msk-dashboard-production.up.railway.app/api/total-amount"
          );
          const data = await res.json();

          const total = data.total_amount;

          document.getElementById("totalAmountValue").innerText =
            formatSmartNumber(total);
        } catch (err) {
          console.error("Gagal load total amount:", err);
          document.getElementById("totalAmountValue").innerText = "-";
        }
      }

      loadTotalAmount();
    </script>

    <script>
      async function loadGenderPie() {
        try {
          const res = await fetch(
            "https://msk-dashboard-production.up.railway.app/api/gender"
          );
          const data = await res.json();

          new ApexCharts(document.querySelector("#genderPie"), {
            chart: {
              type: "pie",
              height: 260,
              toolbar: {
                show: true,
                tools: {
                  download: true,
                },
              },
            },
            labels: ["Laki-Laki", "Perempuan"],
            series: [data.persenlk, data.persenpr],
            legend: {
              position: "bottom",
            },
            tooltip: {
              y: {
                formatter: (val) => val.toLocaleString("id-ID"),
              },
            },
            dataLabels: {
              formatter: function (val, opts) {
                return opts.w.config.series[opts.seriesIndex].toLocaleString(
                  "id-ID"
                );
              },
            },
          }).render();
        } catch (err) {
          console.error("Gagal load gender pie:", err);
        }
      }

      loadGenderPie();
    </script>

    <script>
      async function loadMotorBar() {
        try {
          const res = await fetch(
            "https://msk-dashboard-production.up.railway.app/api/type-motor"
          );
          const data = await res.json();

          // mapping API -> ApexCharts
          const categories = data.map((item) => item.type);
          const seriesData = data.map((item) => item.total);

          new ApexCharts(document.querySelector("#motorBar"), {
            chart: {
              type: "bar",
              height: 260,
              toolbar: {
                show: true,
                tools: {
                  download: true,
                },
              },
            },
            plotOptions: {
              bar: {
                horizontal: true,
                barHeight: "70%",
              },
            },
            dataLabels: {
              enabled: false,
            },
            series: [
              {
                name: "Unit",
                data: seriesData,
              },
            ],
            xaxis: {
              categories: categories,
            },
            tooltip: {
              y: {
                formatter: (val) => val.toLocaleString("id-ID"),
              },
            },
          }).render();
        } catch (err) {
          console.error("Gagal load type motor:", err);
        }
      }

      loadMotorBar();
    </script>

    <script>
      async function loadJobBar() {
        try {
          const res = await fetch(
            "https://msk-dashboard-production.up.railway.app/api/pekerjaan"
          );
          const data = await res.json();

          // mapping API -> ApexCharts
          const categories = data.map((item) => item.pekerjaan);
          const seriesData = data.map((item) => item.total);

          new ApexCharts(document.querySelector("#jobBar"), {
            chart: {
              type: "bar",
              height: 260,
              toolbar: {
                show: true,
                tools: {
                  download: true,
                },
              },
            },
            plotOptions: {
              bar: {
                horizontal: true,
                barHeight: "55%",
              },
            },
            dataLabels: {
              enabled: true,
              formatter: (val) => val.toLocaleString("id-ID"),
            },
            series: [
              {
                name: "Jumlah",
                data: seriesData,
              },
            ],
            xaxis: {
              categories: categories,
            },
            tooltip: {
              y: {
                formatter: (val) => val.toLocaleString("id-ID"),
              },
            },
          }).render();
        } catch (err) {
          console.error("Gagal load pekerjaan:", err);
        }
      }

      loadJobBar();
    </script>

    <script>
      /* ======================
   TOJ BAR
====================== */
      new ApexCharts(document.querySelector("#tojBar"), {
        chart: {
          type: "bar",
          height: 260,
          toolbar: { show: false },
        },
        series: [
          {
            name: "TOJ",
            data: [15.9, 9.3, 6.9, 6.4, 5.7, 5.5, 4.1, 3.8, 3.6, 0.2],
          },
        ],
        plotOptions: {
          bar: {
            columnWidth: "50%",
            borderRadius: 0,
          },
        },
        dataLabels: { enabled: false },
        xaxis: {
          categories: [
            "GO",
            "PL",
            "KPB1",
            "KPB2",
            "LR",
            "KPB3",
            "C1",
            "PR",
            "KPB4",
            "HR",
          ],
        },
      }).render();

      /* ======================
   TYPE MOTOR
====================== */

      /* ======================
   PEKERJAAN
====================== */
    </script>
  </body>
</html>
